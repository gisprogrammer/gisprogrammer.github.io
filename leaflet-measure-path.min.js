!function(){"use strict";L.Marker.Measurement=L[L.Layer?"Layer":"Class"].extend({options:{pane:"markerPane"},initialize:function(latlng,measurement,title,rotation,options){L.setOptions(this,options),this._latlng=latlng,this._measurement=measurement,this._title=title,this._rotation=rotation},addTo:function(map){return map.addLayer(this),this},onAdd:function(map){this._map=map;var pane=this.getPane?this.getPane():map.getPanes().markerPane,el=this._element=L.DomUtil.create("div","leaflet-zoom-animated leaflet-measure-path-measurement",pane),inner=L.DomUtil.create("div","",el);inner.title=this._title,inner.innerHTML=this._measurement,map.on("zoomanim",this._animateZoom,this),this._setPosition()},onRemove:function(map){var pane;map.off("zoomanim",this._animateZoom,this),(this.getPane?this.getPane():map.getPanes().markerPane).removeChild(this._element),this._map=null},_setPosition:function(){L.DomUtil.setPosition(this._element,this._map.latLngToLayerPoint(this._latlng)),this._element.style.transform+=" rotate("+this._rotation+"rad)"},_animateZoom:function(opt){var pos=this._map._latLngToNewLayerPoint(this._latlng,opt.zoom,opt.center).round();L.DomUtil.setPosition(this._element,pos),this._element.style.transform+=" rotate("+this._rotation+"rad)"}}),L.marker.measurement=function(latLng,measurement,title,rotation,options){return new L.Marker.Measurement(latLng,measurement,title,rotation,options)};var formatDistance=function(d){var unit,feet;return this._measurementOptions.imperial?(feet=d/.3048)>3e3?(d/=1609.344,unit="mi"):(d=feet,unit="ft"):d>1e3?(d/=1e3,unit="km"):unit="m",d<100?d.toFixed(1)+" "+unit:Math.round(d)+" "+unit},formatArea=function(a){var unit,sqfeet;return this._measurementOptions.imperial?a>404.685642?(a/=4046.85642,unit="ac"):(a/=.09290304,unit="ft²"):this._measurementOptions.ha?a>1e9?(a/=1e9,unit="km²"):a>1e4?(a/=1e4,unit="ha"):unit="m²":a>1e6?(a/=1e6,unit="km²"):unit="m²",a<100?a.toFixed(1)+" "+unit:Math.round(a)+" "+unit},RADIUS=6378137,ringArea=function ringArea(coords){var rad=function rad(_){return _*Math.PI/180},p1,p2,p3,lowerIndex,middleIndex,upperIndex,area=0,coordsLength=coords.length;if(coordsLength>2){for(var i=0;i<coordsLength;i++)i===coordsLength-2?(lowerIndex=coordsLength-2,middleIndex=coordsLength-1,upperIndex=0):i===coordsLength-1?(lowerIndex=coordsLength-1,middleIndex=0,upperIndex=1):(lowerIndex=i,middleIndex=i+1,upperIndex=i+2),p1=coords[lowerIndex],p2=coords[middleIndex],area+=(rad((p3=coords[upperIndex]).lng)-rad(p1.lng))*Math.sin(rad(p2.lat));area=area*RADIUS*RADIUS/2}return Math.abs(area)},addInitHook=function(){var showOnHover=this.options.measurementOptions&&this.options.measurementOptions.showOnHover;this.options.showMeasurements&&!showOnHover&&this.showMeasurements(),this.options.showMeasurements&&showOnHover&&(this.on("mouseover",(function(){this.showMeasurements()})),this.on("mouseout",(function(){this.hideMeasurements()})))},circleArea=function circleArea(d){var rho=d/RADIUS;return 2*Math.PI*RADIUS*RADIUS*(1-Math.cos(rho))},override=function(method,fn,hookAfter){return hookAfter?function(){return fn.apply(this,arguments),method.apply(this,arguments)}:function(){var originalReturnValue=method.apply(this,arguments),args=Array.prototype.slice.call(arguments);return args.push(originalReturnValue),fn.apply(this,args)}};L.Polyline.include({showMeasurements:function(options){return!this._map||this._measurementLayer?this:(this._measurementOptions=L.extend({showOnHover:options&&options.showOnHover||!1,minPixelDistance:30,showDistances:!0,showArea:!0,showTotalDistance:!0,lang:{totalLength:"Total length",totalArea:"Total area",segmentLength:"Segment length"}},options||{}),this._measurementLayer=L.layerGroup().addTo(this._map),this.updateMeasurements(),this._map.on("zoomend",this.updateMeasurements,this),this)},hideMeasurements:function(){return this._map?(this._map.off("zoomend",this.updateMeasurements,this),this._measurementLayer?(this._map.removeLayer(this._measurementLayer),this._measurementLayer=null,this):this):this},onAdd:override(L.Polyline.prototype.onAdd,(function(originalReturnValue){var showOnHover=this.options.measurementOptions&&this.options.measurementOptions.showOnHover;return this.options.showMeasurements&&!showOnHover&&this.showMeasurements(this.options.measurementOptions),originalReturnValue})),onRemove:override(L.Polyline.prototype.onRemove,(function(originalReturnValue){return this.hideMeasurements(),originalReturnValue}),!0),setLatLngs:override(L.Polyline.prototype.setLatLngs,(function(originalReturnValue){return this.updateMeasurements(),originalReturnValue})),spliceLatLngs:override(L.Polyline.prototype.spliceLatLngs,(function(originalReturnValue){return this.updateMeasurements(),originalReturnValue})),formatDistance:formatDistance,formatArea:formatArea,updateMeasurements:function(){if(!this._measurementLayer)return this;var latLngs=this.getLatLngs(),isPolygon=this instanceof L.Polygon,options=this._measurementOptions,totalDist=0,formatter,ll1,ll2,p1,p2,pixelDist,dist;if(latLngs&&latLngs.length&&L.Util.isArray(latLngs[0])&&(latLngs=latLngs[0]),this._measurementLayer.clearLayers(),this._measurementOptions.showDistances&&latLngs.length>1){formatter=this._measurementOptions.formatDistance||L.bind(this.formatDistance,this);for(var i=1,len=latLngs.length;isPolygon&&i<=len||i<len;i++)ll1=latLngs[i-1],ll2=latLngs[i%len],totalDist+=dist=ll1.distanceTo(ll2),p1=this._map.latLngToLayerPoint(ll1),p2=this._map.latLngToLayerPoint(ll2),(pixelDist=p1.distanceTo(p2))>=options.minPixelDistance&&L.marker.measurement(this._map.layerPointToLatLng([(p1.x+p2.x)/2,(p1.y+p2.y)/2]),formatter(dist),options.lang.segmentLength,this._getRotation(ll1,ll2),options).addTo(this._measurementLayer);!isPolygon&&this._measurementOptions.showTotalDistance&&L.marker.measurement(ll2,formatter(totalDist),options.lang.totalLength,0,options).addTo(this._measurementLayer)}if(isPolygon&&options.showArea&&latLngs.length>2){formatter=options.formatArea||L.bind(this.formatArea,this);var area=ringArea(latLngs);L.marker.measurement(this.getBounds().getCenter(),formatter(area),options.lang.totalArea,0,options).addTo(this._measurementLayer)}return this},_getRotation:function(ll1,ll2){var p1=this._map.project(ll1),p2=this._map.project(ll2);return Math.atan((p2.y-p1.y)/(p2.x-p1.x))}}),L.Polyline.addInitHook((function(){addInitHook.call(this)})),L.Circle.include({showMeasurements:function(options){return!this._map||this._measurementLayer?this:(this._measurementOptions=L.extend({showOnHover:!1,showArea:!0,lang:{totalArea:"Total area"}},options||{}),this._measurementLayer=L.layerGroup().addTo(this._map),this.updateMeasurements(),this._map.on("zoomend",this.updateMeasurements,this),this)},hideMeasurements:function(){return this._map?(this._map.on("zoomend",this.updateMeasurements,this),this._measurementLayer?(this._map.removeLayer(this._measurementLayer),this._measurementLayer=null,this):this):this},onAdd:override(L.Circle.prototype.onAdd,(function(originalReturnValue){var showOnHover=this.options.measurementOptions&&this.options.measurementOptions.showOnHover;return this.options.showMeasurements&&!showOnHover&&this.showMeasurements(this.options.measurementOptions),originalReturnValue})),onRemove:override(L.Circle.prototype.onRemove,(function(originalReturnValue){return this.hideMeasurements(),originalReturnValue}),!0),setLatLng:override(L.Circle.prototype.setLatLng,(function(originalReturnValue){return this.updateMeasurements(),originalReturnValue})),setRadius:override(L.Circle.prototype.setRadius,(function(originalReturnValue){return this.updateMeasurements(),originalReturnValue})),formatArea:formatArea,updateMeasurements:function(){if(this._measurementLayer){var latLng=this.getLatLng(),options=this._measurementOptions,formatter=options.formatArea||L.bind(this.formatArea,this);if(this._measurementLayer.clearLayers(),options.showArea){formatter=options.formatArea||L.bind(this.formatArea,this);var area=circleArea(this.getRadius());L.marker.measurement(latLng,formatter(area),options.lang.totalArea,0,options).addTo(this._measurementLayer)}}}}),L.Circle.addInitHook((function(){addInitHook.call(this)}))}();