var map=null,polygon=null;function drukuj(map,L){L.control.browserPrint({title:"Wydruk mapy!",documentTitle:"Map printed using leaflet.browser.print plugin code:gisprogrammer.github.io/",closePopupsOnPrint:!1,printModes:[L.control.browserPrint.mode.landscape(),"Portrait"],manualMode:!1}).addTo(map)}function load(){map=L.map("mapa").setView([52,19],6),L.tileLayer("https://mapy.geoportal.gov.pl/wss/ext/OSM/BaseMap/tms/1.0.0/osm_3857/GLOBAL_WEBMERCATOR/{z}/{x}/{y}.png",{tms:!0,zoomOffset:-1,attribution:'&copy; <a href="https://osm.org/copyright">OpenStreetMap</a> contributors <a href="https://gisprogrammer.github.io">github code</a>'}).addTo(map);var wmsLayer=L.tileLayer.wms("https://integracja.gugik.gov.pl/cgi-bin/KrajowaIntegracjaEwidencjiGruntow",{layers:"geoportal,dzialki,numery_dzialek,budynki",format:"image/png",transparent:!0}).addTo(map);window.osmMap=map,drukuj(map,L)}function addPolygon(points){for(var gPoints=new Array,_p=points.split(","),cX=0,cY=0,p0=null,gPoints2=new Array,xMin=1e3,yMin=1e3,xMax=-1e3,yMax=-1e3,i=0;i<_p.length;i++){var point=_p[i].split(" ");null==p0&&(p0=point),cX+=parseFloat(point[0]),cY+=parseFloat(point[1]),xMin=Math.min(xMin,point[0]),xMax=Math.max(xMax,point[0]),yMin=Math.min(yMin,point[1]),yMax=Math.max(yMax,point[1]),gPoints.push(new Array(point[1],point[0]))}var center=new Array(cY/i,cX/i);polygon&&polygon.remove();var bounds=L.latLngBounds(L.latLng(yMin,xMin),L.latLng(yMax,xMax));window.osmMap.fitBounds(bounds,{animate:!1}),polygon=L.polygon([gPoints],{showMeasurements:!0}).addTo(window.osmMap)}function szukajDzialkiNew(){var w=document.getElementById("pole_szukaj_dzialki").value;if(w.length<15&&-1==w.search(" "))return alert("Podany teryt jest za krótki"),0;""!=w&&advAJAX.post({url:"https://uldk.dzialkikatastralne.pl/index.php",parameters:{request:"GetParcelByIdOrNr",id:w,result:"id,numer,powiat,gmina,geom_wkt",srid:4326},onSuccess:function(obj){for(var results=[],lines=obj.responseText.split("\n"),i=0;i<lines.length;i++){var fields=lines[i].split("|");results[i]=[];for(var j=0;j<fields.length;j++)results[i][j]=fields[j]}if(-1!=results[0][0]){for(var tab='<table class="wyniki"><tr><th>Identyfikator</th><th>Powiat</th><th>Gmina</th></tr>',licznik=0,i=1;i<results.length;i++)results[i][0]&&(licznik++,geom=results[i][4],geom&&(geom=geom.replace("SRID=4326;",""),geom=geom.replace("POLYGON((",""),geom=geom.replace("))",""),geom=geom.replace("\r",""),tab+='<tr class="wyniki_tr" onclick="addPolygon(\''+geom+"');\">                     <td>"+results[i][0]+"</td>                     <td>"+results[i][2]+"</td>                     <td>"+results[i][3]+"</td>                     </tr>"));tab+="</table>",addPolygon(geom),document.getElementById("wyniki").innerHTML=tab}else alert("Działka o podanym identyfikatorze nie została odnaleziona")}})}function onkeyszukajdzialki(evt){var keyCode=null;evt.which?keyCode=evt.which:evt.keyCode&&(keyCode=evt.keyCode),13==keyCode&&szukajDzialkiNew()}