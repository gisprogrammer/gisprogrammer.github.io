var map=null,polygon=null;function load(){map=L.map("mapa").setView([52,19],6),L.tileLayer("https://mapy.geoportal.gov.pl/wss/ext/OSM/BaseMap/tms/1.0.0/osm_3857/GLOBAL_WEBMERCATOR/{z}/{x}/{y}.png",{tms:!0,zoomOffset:-1,attribution:'&copy; <a href="https://osm.org/copyright">OpenStreetMap</a> contributors'}).addTo(map);L.tileLayer.wms("https://integracja.gugik.gov.pl/cgi-bin/KrajowaIntegracjaEwidencjiGruntow",{layers:"geoportal,dzialki,numery_dzialek,budynki",format:"image/png",transparent:!0}).addTo(map);window.osmMap=map}function addPolygon(a){for(var e=new Array,t=a.split(","),o=0,n=0,r=null,i=(new Array,1e3),l=1e3,s=-1e3,p=-1e3,d=0;d<t.length;d++){var m=t[d].split(" ");null==r&&(r=m),o+=parseFloat(m[0]),n+=parseFloat(m[1]),i=Math.min(i,m[0]),s=Math.max(s,m[0]),l=Math.min(l,m[1]),p=Math.max(p,m[1]),e.push(new Array(m[1],m[0]))}new Array(n/d,o/d);polygon&&polygon.remove();var g=L.latLngBounds(L.latLng(l,i),L.latLng(p,s));window.osmMap.fitBounds(g,{animate:!1}),polygon=L.polygon([e],{showMeasurements:!0}).addTo(window.osmMap)}function szukajDzialkiNew(){var a=document.getElementById("pole_szukaj_dzialki").value;if(a.length<15&&-1==a.search(" "))return alert("Podany teryt jest za krĂłtki"),0;""!=a&&advAJAX.post({url:"https://uldk.dzialkikatastralne.pl/index.php",parameters:{request:"GetParcelByIdOrNr",id:a,result:"id,numer,powiat,gmina,geom_wkt",srid:4326},onSuccess:function(a){for(var e=[],t=a.responseText.split("\n"),o=0;o<t.length;o++){var n=t[o].split("|");e[o]=[];for(var r=0;r<n.length;r++)e[o][r]=n[r]}if(-1!=e[0][0]){var i='<table class="wyniki"><tr><th>Identyfikator</th><th>Powiat</th><th>Gmina</th></tr>';for(o=1;o<e.length;o++)e[o][0]&&(geom=e[o][4],geom&&(geom=geom.replace("SRID=4326;",""),geom=geom.replace("POLYGON((",""),geom=geom.replace("))",""),geom=geom.replace("\r",""),i+='<tr class="wyniki_tr" onclick="addPolygon(\''+geom+"');\">                     <td>"+e[o][0]+"</td>                     <td>"+e[o][2]+"</td>                     <td>"+e[o][3]+"</td>                     </tr>"));i+="</table>",addPolygon(geom),document.getElementById("wyniki").innerHTML=i}else alert("DziaĹ‚ka o podanym identyfikatorze nie zostaĹ‚a odnaleziona")}})}function onkeyszukajdzialki(a){var e=null;a.which?e=a.which:a.keyCode&&(e=a.keyCode),13==e&&szukajDzialkiNew()}