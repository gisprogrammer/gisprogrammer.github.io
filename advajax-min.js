function advAJAX(){this.url=window.location.href,this.method="GET",this.parameters=new Object,this.headers=new Object,this.mimeType="text/html",this.username=null,this.password=null,this.useJSON=!1,this.unique=!0,this.uniqueParameter="_uniqid",this.requestDone=!1,this.requestAborted=!1,this.requestTimedOut=!1,this.queryString="",this.responseText=null,this.responseXML=null,this.responseJSON=null,this.status=null,this.statusText=null,this.timeout=0,this.retryCount=0,this.retryDelay=1e3,this.retryNo=0,this.repeat=!1,this.repeatCount=0,this.repeatNo=0,this.repeatDelay=1e3,this.tag=null,this.group=null,this.form=null,this.disableForm=!0,this.onInitialization=null,this.onFinalization=null,this.onAbort=null,this.onReadyStateChange=null,this.onLoading=null,this.onLoaded=null,this.onInteractive=null,this.onComplete=null,this.onSuccess=null,this.onFatalError=null,this.onInternalError=null,this.onError=null,this.onTimeout=null,this.onRetryDelay=null,this.onRetry=null,this.onRepeat=null,this.onRepeatDelay=null,this.onGroupEnter=null,this.onGroupLeave=null,this._xhr=null,this._eventHandled=[!1],this._timerTimeout=null,this._timerRepeat=null,this.init=function(){if(null!==this._xhr&&this.destroy(),null===(this._xhr=this._createXHR()))return!1;void 0!==advAJAX._defaultParameters&&this.handleArguments(advAJAX._defaultParameters),"function"==typeof this._xhr.overrideMimeType&&this._xhr.overrideMimeType(this.mimeType),this._eventHandled=[this._eventHandled[0],!1,!1,!1,!1];var t=this;return this._xhr.onreadystatechange=function(){t.requestAborted||(t._raise("ReadyStateChange",t._xhr.readyState),!t._eventHandled[t._xhr.readyState]&&t._handleReadyState(t._xhr.readyState))},!0},this.destroy=function(){try{this._xhr.abort(),delete this._xhr.onreadystatechange}catch(t){}this._xhr=null},this._createXHR=function(){if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;for(var t=["MSXML2.XMLHttp.5.0","MSXML2.XMLHttp.4.0","MSXML2.XMLHttp.3.0","MSXML2.XMLHttp","Microsoft.XMLHttp"],e=0;e<t.length;e++)try{return new ActiveXObject(t[e])}catch(t){}return this._raise("FatalError"),null},this._handleReadyState=function(readyState){if(!this._eventHandled[readyState])switch(this._eventHandled[readyState]=!0,readyState){case 1:0==this.retryNo&&null!==this.group&&(void 0===advAJAX._groupData[this.group]&&(advAJAX._groupData[this.group]=0,this._raise("GroupEnter",this.group)),advAJAX._groupData[this.group]++),this._raise("Loading",this);break;case 2:this._raise("Loaded",this);break;case 3:this._raise("Interactive",this);break;case 4:if(window.clearTimeout(this._timerTimeout),this.requestAborted)return;this.requestDone=!0,this.responseText=this._xhr.responseText,this.responseXML=this._xhr.responseXML;try{this.status=this._xhr.status||null,this.statusText=this._xhr.statusText||null}catch(t){this.status=null,this.statusText=null}if(this._raise("Complete",this),200==this.status){this._raise("Success",this);try{var _contentType=this._xhr.getResponseHeader("Content-type");_contentType.match(/^text\/javascript/i)?eval(this.responseText):_contentType.match(/^text\/x\-json/i)&&(this.responseJSON=eval("("+this.responseText+")"))}catch(t){this._raise("InternalError",advAJAX.ERROR_INVALID_EVAL_STRING)}}else this._raise("Error",this);if(this.repeat&&++this.repeatNo!=this.repeatCount){this._raise("RepeatDelay",this);var _this=this;return void(this._timerRepeat=window.setTimeout((function(){_this._raise("Repeat",this),_this.init(),_this.run()}),this.repeatDelay))}this.destroy(),this.disableForm&&this._switchForm(!0),this._handleGroup(),this._raise("Finalization",this)}},this._handleGroup=function(){null!==this.group&&0==--advAJAX._groupData[this.group]&&this._raise("GroupLeave",this)},this._onTimeout=function(){if(null!=this._xhr&&!this._eventHandled[4])if(this.requestAborted=this.requestTimedOut=!0,this._xhr.abort(),this._raise("Timeout"),this.retryNo++<this.retryCount){this.init(),this._raise("RetryDelay",this);var t=this;this._timerTimeout=window.setTimeout((function(){t._raise("Retry",t),t.run()}),this.retryDelay)}else this.destroy(),this.disableForm&&this._switchForm(!0),this._handleGroup(),this._raise("Finalization",this)},this.run=function(){if(0==this.init())return!1;if(this.requestAborted=this.requestTimedOut=!1,!this._eventHandled[0]&&this._raise("Initialization",this)&&(this._eventHandled[0]=!0),0==this.retryNo&&0==this.repeatNo){if(this.useJSON){if("function"!=typeof[].toJSONString)return void this._raise("InternalError",advAJAX.ERROR_NO_JSON);for(var t in this.parameters){this.queryString.length>0&&(this.queryString+="&"),this.queryString+=encodeURIComponent(t)+"="+encodeURIComponent(this.parameters[t].toJSONString())}}else for(var t in this.parameters)if(this.queryString.length>0&&(this.queryString+="&"),"object"!=typeof this.parameters[t])this.queryString+=encodeURIComponent(t)+"="+encodeURIComponent(this.parameters[t]);else{if(!(this.parameters[t]instanceof Array))continue;for(var e=0,i=this.parameters[t].length;e<i;e++)this.queryString+=encodeURIComponent(t)+"="+encodeURIComponent(this.parameters[t][e])+"&";this.queryString=this.queryString.slice(0,-1)}"GET"==this.method&&this.unique&&(this.queryString.length>0&&(this.queryString+="&"),this.queryString+=encodeURIComponent(this.uniqueParameter)+"="+(new Date).getTime().toString().substr(5)+Math.floor(100*Math.random()).toString()),"GET"==this.method&&this.queryString.length>0&&(this.url+=(-1!=this.url.indexOf("?")?"&":"?")+this.queryString)}this.disableForm&&this._switchForm(!1);try{this._xhr.open(this.method,this.url,!0,this.username||"",this.password||"")}catch(t){return this._raise("FatalError",this),!1}var s=this;if(this.timeout>0&&(this._timerTimeout=window.setTimeout((function(){s._onTimeout()}),this.timeout)),"function"==typeof this._xhr.setRequestHeader)for(var t in this.headers)this._xhr.setRequestHeader(encodeURIComponent(t),encodeURIComponent(this.headers[t]));if("POST"==this.method){try{this._xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded")}catch(t){}this._xhr.send(this.queryString)}else"GET"==this.method&&this._xhr.send("")},this.abort=function(){this.requestAborted=!0,window.clearTimeout(this._timerTimeout),window.clearTimeout(this._timerRepeat),this._handleGroup(),this._raise("Abort",this),this.destroy(),this._raise("Finalization",this)},this._extendObject=function(t,e){for(var i in e)t[i]=e[i]},this.handleArguments=function(t){for(var e in"string"==typeof t.form&&(t.form=document.getElementById(t.form)),t)void 0===this[e]?this.parameters[e]=t[e]:"parameters"!=e&&"headers"!=e?this[e]=t[e]:this._extendObject(this[e],t[e]);this.method=this.method.toUpperCase(),"object"==typeof this.form&&null!==this.form&&this._appendForm(),t.repeat&&this.repeatCount++},this._switchForm=function(t){if("object"==typeof this.form&&null!==this.form)for(var e=this.form,i=0;i<e.elements.length;i++)if(t){void 0!==e.elements[i]._disabled&&null!==e.elements[i]._disabled||(e.elements[i].disabled="");try{delete e.elements[i]._disabled}catch(t){e.elements[i]._disabled=null}}else e.elements[i].disabled?e.elements[i]._disabled=!0:e.elements[i].disabled="disabled"},this._appendForm=function(){var t=this.form;this.method=t.getAttribute("method").toUpperCase(),this.url=t.getAttribute("action");for(var e=0;e<t.elements.length;e++){var i=t.elements[e];if(!i.disabled)switch(i.type){case"text":case"password":case"hidden":case"textarea":this._addParameter(i.name,i.value);break;case"select-one":i.selectedIndex>=0&&this._addParameter(i.name,i.options[i.selectedIndex].value);break;case"select-multiple":for(var s=[],r=0;r<i.options.length;r++)i.options[r].selected&&(s[s.length]=i.options[r].value);s.length>0&&this._addParameter(i.name,s);break;case"checkbox":case"radio":i.checked&&this._addParameter(i.name,i.value);break}}},this._addParameter=function(t,e){void 0===this.parameters[t]?this.parameters[t]=e:"object"!=typeof this.parameters[t]?this.parameters[t]=[this.parameters[t],e]:this.parameters[t][this.parameters[t].length]=e},this._delParameter=function(t){delete this.parameters[t]},this._raise=function(t){for(var e=1,i=[];e<arguments.length;i[i.length]=arguments[e++]);"function"==typeof this["on"+t]&&this["on"+t].apply(null,i),"FatalError"==t&&this._raise("Finalization",this)}}advAJAX._groupData=new Object,advAJAX._defaultParameters=new Object,advAJAX.get=function(t){return advAJAX._handleRequest("GET",t)},advAJAX.post=function(t){return advAJAX._handleRequest("POST",t)},advAJAX.head=function(t){return advAJAX._handleRequest("HEAD",t)},advAJAX._handleRequest=function(t,e){e=e||{};var i=new advAJAX;return i.method=t,i.handleArguments(e),setTimeout((function(){i.run()}),0),i},advAJAX.submit=function(t,e){if(e=e||{},null==t)return!1;var i=new advAJAX;return e.form=t,i.handleArguments(e),setTimeout((function(){i.run()}),0),i},advAJAX.assign=function(t,e){if(e=e||{},"string"==typeof t&&(t=document.getElementById(t)),null==t)return!1;t._advajax_args=e;var i=function(t){(t=t||window.event).preventDefault?(t.preventDefault(),t.stopPropagation()):(t.returnValue=!1,t.cancelBubble=!0);var e=t.target||t.srcElement;return!advAJAX.submit(e,e._advajax_args)};return t.addEventListener?t.addEventListener("submit",i,!1):t.attachEvent&&t.attachEvent("onsubmit",i),!0},advAJAX.download=function(t,e){if("string"==typeof t&&(t=document.getElementById(t)),null==t)return!1;advAJAX.get({url:e,onSuccess:function(e){t.innerHTML=e.responseText}})},advAJAX.setDefaultParameters=function(t){for(var e in advAJAX._defaultParameters=new Object,t)advAJAX._defaultParameters[e]=t[e]},advAJAX.ERROR_INVALID_EVAL_STRING=-1,advAJAX.ERROR_NO_JSON=-2;